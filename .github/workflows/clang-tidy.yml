name: Clang Tidy

on:
  push:
    branches:
    - master
  pull_request:
    branches:
    - master

jobs:
  build:
    runs-on: ubuntu-latest
    container: qdrvm/kagome-dev@sha256:2d70246c32418a3dd45c246d3f5c2dd99bdafde145b903271849affe476c4cfc
    steps:
    - uses: actions/checkout@v1
      name: checkout
      with:
        submodules: true
        clean: true
        fetch-depth: 1
    - name: run checks
      env:
        BUILD_DIR: build
      run: |
        #!/bin/bash -xe
        source /venv/bin/activate
        cmake -G Ninja -B $BUILD_DIR .
        cmake --build $BUILD_DIR --target generated
        ./housekeeping/clang-tidy-diff.sh

